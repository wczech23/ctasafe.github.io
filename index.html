
<html>
<head><link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css"
     integrity="sha256-p4NxAoJBhIIN+hmNHrzRCf9tD/miZyoHS5obTRR9BMY="
     crossorigin=""/>
     <style>
        #map {
                height: 600px;
                width: 600px;
                margin: 0 auto;
                margin-top: 150;
                border: 4px solid #0d0c0c;
                display: none;
             }
        #form-container {
                text-align: center;
                margin-top: 100px;
             } 
     </style>
</head>
<body>
  <label for="lineDropdown">Select Line:</label>
  <select id="lineDropdown">
    <option value="">-- Choose a line --</option>
    <option value="red">Red</option>
    <option value="blue">Blue</option>
    <option value="green">Green</option>
    <option value="orange">Orange</option>
    <option value="brown">Brown</option>
    <option value="pink">Pink</option>
  </select>

  <br><br>

  <label for="stationDropdown">Select Station:</label>
  <select id="stationDropdown">
    <option value="">-- Select a station --</option>
  </select>


<div id="map"></div>
<script 
     src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"
     integrity="sha256-20nQCchB9co0qIjJZRGuk2/Z9VM+kNiyxNV1lvTlZBo="
     crossorigin="">
</script>
<script 
      src="https://cdn.jsdelivr.net/npm/papaparse@5.4.1/papaparse.min.js">
</script>
<script>
  // start of webpage script

  // load in data upon line selection
  const lineDropdown = document.getElementById("lineDropdown");
  const stationDropdown = document.getElementById("stationDropdown");

  lineDropdown.addEventListener("change", function () {
    const line = this.value.toLowerCase();
    console.log("here")
    if (!line) {
      stationDropdown.innerHTML = '<option value="">-- Select a station --</option>';
      return;
    }

    const csvFile = `stop_data/${line}_line_stops.csv`;

    fetch(csvFile)
      .then(response => response.text())
      .then(data => {
        const lines = data.trim().split('\n');
        const headers = lines[0].split(',');

        const nameIndex = headers.indexOf("STATION_NAME");
        if (nameIndex === -1) {
          console.error("STATION_NAME column not found");
          return;
        }

        // Clear and repopulate station dropdown
        stationDropdown.innerHTML = '<option value="">-- Select a station --</option>';
        lines.slice(1).forEach(row => {
          const cols = row.split(',');
          const stationName = cols[nameIndex];
          const option = document.createElement("option");
          option.value = stationName;
          option.textContent = stationName;
          stationDropdown.appendChild(option);
        });
      })
      .catch(error => {
        console.error("Error loading CSV:", error);
      });
  });
  

  const map = L.map('map').setView([41.88, -87.63], 10);
  L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png').addTo(map);
  
  Papa.parse("chicago_crime_data.csv", {
    download: true,
    header: true,
    complete: function(results) {
      console.log("finished:", results.data);
      const rows = results.data;
      rows.forEach(d => {
        if (d.latitude && d.longitude) {
          L.circleMarker([+d.latitude, +d.longitude], { radius: 6 })
            .bindPopup(d.name || "")
            .addTo(map);
        }
      });
    }
  });
</script></body>
</html>
